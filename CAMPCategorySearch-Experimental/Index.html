<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Fallout 76 C.A.M.P. Item Database">
  <meta property="og:description" content="Database Tool for Fallout 76 C.A.M.P. Items. Lists Workshop Menu categories, C.A.M.P. budget cost, Plan/Entitlement requirements, and allows searches.">
  <meta property="og:image" content="https://raw.githubusercontent.com/MrsBlobby/mrsblobby.github.io/refs/heads/main/assets/CAMPIcon2.png">
  <meta property="og:url" content="https://yourdomain.com/">
  <meta property="og:type" content="website">
  <link rel="icon" type="image/svg" href="/assets/svg/CAMPIcon.svg">
  <title>Fallout 76 C.A.M.P. Item Database</title>
 <style>
  :root {
    --accent: #ffc00f;
    --accent-dim: #ffb300;
    --bg: #1a1a1a;
    --card-bg: #2a2a2a;
    --text: #e0e0e0;
    --text-muted: #aaa;
    --content-width: 800px;
    --card-width: 720px;
  }

  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background-color: var(--bg);
    color: var(--text);
  }

  .container {
    max-width: var(--content-width);
    margin: 0 auto;
    padding: 0 16px;
  }

  h1 {
    color: var(--accent);
    margin-bottom: 5px;
    text-align: center;
  }

 .meta {
  text-align: center;
  margin-top: 0.5em;
}

.author {
  color: var(--text-muted);
  font-size: 14px;
}

.badge-link {
  background: #333;
  color: var(--accent);
  border-radius: 4px;
  padding: 2px 6px;
  margin-left: 6px;
  text-decoration: none;
  font-size: 12px;
  transition: background 0.2s;
}

.badge-link:hover {
  background: #555;
}

.updated {
  color: var(--text-muted);
  font-size: 12px;
  margin-top: 4px;
}



  #pagination button {
    padding: 6px 10px;
    background: var(--card-bg);
    color: var(--text);
    border: 1px solid var(--accent);
    border-radius: 4px;
    cursor: pointer;
    transition: 0.2s;
  }
  #pagination button:hover:not(:disabled) {
    background: var(--accent);
    color: black;
  }
  #pagination button:disabled {
    opacity: 0.4;
    cursor: default;
  }

.controls {
  position: sticky;
  top: 0;
  z-index: 100;
  background: var(--bg);
  padding: 12px 16px;
  border-bottom: 1px solid var(--card-bg);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 12px;
}

  .controls input[type="text"] {
    padding: 10px;
    font-size: 16px;
    width: 100%;
    max-width: 350px;
    border: 2px solid var(--accent);
    border-radius: 6px;
    background-color: var(--card-bg);
    color: var(--text);
  }

.controls .search-line {
  display: flex;
  gap: 0;
  width: 100%;
  max-width: 450px;
}

.search-line input:focus,
.search-line select:focus,
.search-line textarea:focus {
  outline: none;
  box-shadow: none;
}

.search-line input {
  -webkit-appearance: none;
}

.search-line {
  display: flex;
  gap: 0;
  width: 100%;
  max-width: 450px;
  align-items: center; 
}

  .controls label {
    font-size: 14px;
    color: var(--text-muted);
    margin-left: 4px;
  }

  .controls .inline-group {
    display: flex;
    align-items: center;
    gap: 8px;
    justify-content: center;
    margin-top: 8px;
  }

.inline-group {
  display: flex;
  align-items: center;
  gap: 40px;
  justify-content: center;
  margin-top: 8px;
}


.inline-group label {
  font-size: 14px;
  color: var(--text-muted);
}

.group-filters {
  display: flex;
  margin-right: 30px;
  flex-shrink: 0;
}

.group-sort {
  display: flex;
  align-items: center;
  gap: 8px; 
}

  ul {
    list-style-type: none;
    padding: 16px;
    margin: 0 auto;
    max-width: 600px;
  }

  li {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 12px;
    background-color: var(--card-bg);
    margin-bottom: 14px;
    border-radius: 6px;
    border: 2px solid var(--accent);
    box-shadow: 0 2px 6px rgba(0,0,0,0.4);
    width: 100%;
  }

  .result-left {
    display: flex;
    flex-direction: column;
    align-items: center;
    flex-shrink: 0;
    width: 220px;
  }

  .result-name {
    font-weight: bold;
    font-size: 18px;
    color: var(--accent);
    margin-bottom: 6px;
    text-align: center;
  }

  .result-left img {
    border-radius: 6px;
    max-width: 128px;
    height: auto;
    object-fit: contain;
    display: block;
  }

  .result-right {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
    text-align: center;
    width: 100%;
    justify-content: center;
  }

  .result-right .section-header {
    font-weight: 700;
    font-size: 14px;
    color: var(--accent);
    text-align: center;
    margin: 4px 0;
  }

  .result-right span.pill {
    background: var(--bg);
    border: 2px solid var(--accent);
    border-radius: 20px;
    padding: 3px 10px;
    font-size: 14px;
    color: var(--accent);
    font-weight: normal;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
  }

  .inline-wrap {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    flex-wrap: wrap;
  }

  .connector {
    color: var(--accent);
    font-weight: 600;
    font-size: 13px;
    margin: 0 6px;
    line-height: 1;
  }

  .arrow {
    display: inline-block;
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-left: 10px solid var(--accent);
    margin: 0 8px;
    vertical-align: middle;
  }

  .inline-wrap .arrow + .arrow {
    display: none;
  }

  .pill {
    background: var(--bg);
    border: 2px solid var(--accent);
    border-radius: 20px;
    padding: 4px 12px;
    font-size: 14px;
    color: var(--accent);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    line-height: 1.2;
    max-width: 240px;
    min-height: 30px;
    word-break: break-word;
  }

  details {
    margin: 10px 0 20px 0;
    font-size: 12px;
    color: var(--text-muted);
  }

  details summary {
    cursor: pointer;
    font-weight: bold;
    color: var(--accent);
    text-align: center;
    max-width: 200px;
    margin: 0 auto;           
    padding: 2px 6px;
  }

  .changelog-entry h4 {
    margin: 0 0 4px 0;
    font-size: 14px;
    font-weight: bold;
    color: var(--accent);
  }

  .changelog-entry {
    background: rgba(255, 192, 15, 0.05);
    border-left: 3px solid var(--accent);
    border-radius: 4px;
    padding: 6px 12px;
    margin: 6px 0;
    text-align: left;
  }

#searchBox {
  flex: 1;
  height: 40px;
  font-size: 16px;
  padding: 0 12px;
  border: 2px solid var(--accent);
  border-right: none;
  border-radius: 6px 0 0 6px;
  background-color: var(--card-bg);
  color: var(--text);
  box-sizing: border-box;
}

  #searchBox, #dropdownSelected {
    width: 100%;
    border-right: none; 
  }

#dropdownOptions {
  display: none;
  position: absolute;
  font-size: 14px;
  top: 100%;
  left: 0;
  width: 100%;
  margin-top: -2px;
  background-color: var(--card-bg);
  border: 2px solid var(--accent);
  box-sizing: border-box;
  border-radius: 0 0 6px 6px;
  overflow: hidden;
  z-index: 200;
}

#dropdownOptions .option {
  padding: 8px 12px;
  cursor: pointer;
}


#dropdownSelected {
  display: flex;
  align-items: center;
  padding: 0 12px;
  font-size: 14px;
  border: 2px solid var(--accent);
  border-left: 2px solid var(--accent);
  border-radius: 0 6px 6px 0;
  background-color: var(--card-bg);
  color: var(--text);
  cursor: pointer;
  box-sizing: border-box;
}

#dropdownSelected.open {
  border-radius: 0 6px 0 0; /* bottom-right sharp when dropdown is open */
}

.custom-dropdown {
  position: relative;
  width: max-content;
  height: 40px;
  display: flex;
  flex-shrink: 0;
}

#sortDropdown, #sortSelected, #sortOptions,
.custom-dropdown, #dropdownSelected, #dropdownOptions {
  box-sizing: border-box;
}

#filtersButton,
#sortSelected {
  height: 36px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 6px; /* keeps space between text and icon if any */
  padding: 0 12px;
  font-size: 14px;
  line-height: 1;
  border: 2px solid var(--accent);
  border-radius: 6px;
  background-color: var(--card-bg);
  color: var(--text);
  cursor: pointer;
  box-sizing: border-box;
  vertical-align: middle;
}

#filtersDropdown,
#sortDropdown {
  display: inline-flex;
  align-items: center;
  margin: 0;
  padding: 0;
}


#filtersDropdown, #sortDropdown {
  margin: 0;
  padding: 0;
}

#filtersDropdown {
  width: 150px;   
  position: relative;
}

#filtersButton {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px; 
  padding: 0 12px;
  font-size: 14px;
  width: 100%;
  border: 2px solid var(--accent);
  border-radius: 6px;
  background-color: var(--card-bg);
  color: var(--text);
  cursor: pointer;
  box-sizing: border-box;
  height: 36px;
}

#filtersButton .filter-icon {
  width: 20px;  
  height: 20px;
  flex-shrink: 0;
  vertical-align: middle;
}

.filter-columns {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.filter-columns > div {
  flex: 1;
}

.filter-header {
  font-weight: bold;
  text-align: center;
  background-color: rgba(255, 192, 15, 0.1);
  color: var(--accent);
  border-radius: 4px 4px 0 0;
  padding: 4px 8px;     
  margin: 0 0 2px 0;    
  font-size: 13px;
}

#filtersOptions button {
  padding: 6px 10px;
  border: 1px solid var(--accent);
  border-radius: 4px;
  background: var(--card-bg);
  cursor: pointer;
}

#filtersOptions button[data-filter] {
  display: block;
  width: 100%;
  padding: 2px 6px; 
  margin: 0;         
  text-align: center;
  border: none;
  background: none;  
  color: white;     
  font-size: 13px;   
  line-height: 1;
  cursor: pointer;
}

#filtersOptions button[data-filter].selected {
  background-color: var(--accent);
  color: black;
}

#filtersOptions button[data-filter]:hover {
  background: var(--accent-dim);
  color: black;
}

.filter-header {
  font-weight: bold;
  font-size: 13px;
  text-align: center;
  background-color: rgba(255, 192, 15, 0.1); 
  color: var(--accent);
  padding: 2px 0;          
  margin: 4px 0 2px 0;    
  border-radius: 4px 4px 0 0; 
}

#filtersOptions button[data-filter]:hover,
#filtersOptions button[data-filter].selected {
  background-color: var(--accent);     
  color: black;                        
}

#filtersButton.open {
  border-bottom-left-radius: 0;
  border-bottom-right-radius: 0;
}

.clear-filters {
  margin-top: 4px;               /* reduce gap above button */
  padding: 4px 8px;              /* small button */
  background-color: #ffeded;
  border: 1px solid #ff4d4f;
  color: #ff4d4f;
  border-radius: 4px 4px 0 0;    /* only bottom corners rounded */
  cursor: pointer;
  text-align: center;
  font-size: 13px;
  transition: background 0.2s;
}

#filtersOptions {
  display: flex;
  flex-direction: column;
  gap: 0;                 
  padding: 0;
  margin-top: -2px;
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%;
  background-color: var(--card-bg);
  border: 2px solid var(--accent);
  border-radius: 0 0 6px 6px; 
  box-sizing: border-box;
  z-index: 200;
  overflow: hidden;
}

#filtersOptions .option {
  padding: 8px 12px;
  cursor: pointer;
}

#filtersOptions .option:hover {
  background: var(--accent-dim);
  color: black;
}

.clear-filters {
  margin-top: 8px;
  background-color: #ffeded;
  border: 1px solid #ff4d4f;
  color: #ff4d4f;
  border-radius: 4px;
  padding: 4px 8px;
  cursor: pointer;
}

#sortSelected,
#sortOptions,
#filtersButton,
#filtersOptions {
  width: 100%;
  box-sizing: border-box;
}

#sortDropdown {
  position: relative;
  width: 150px; 
  height: 36px;
  display: flex;
  flex-shrink: 0;
}

#sortSelected {
  display: flex;
  align-items: center;
  padding: 0 12px;
  font-size: 14px;
  width: 100%;
  border: 2px solid var(--accent);
  border-radius: 6px;
  background-color: var(--card-bg);
  color: var(--text);
  cursor: pointer;
  box-sizing: border-box;
}

#sortSelected.open {
  border-radius: 6px 6px 0 0;
}

#sortOptions {
  display: none;
  position: absolute;
  top: 100%;
  left: 0;
  width: 100%; 
  margin-top: -2px;
  background-color: var(--card-bg);
  border: 2px solid var(--accent);
  border-radius: 0 0 6px 6px;
  font-size: 14px;
  z-index: 200;
  overflow: hidden;
}

#sortOptions .option {
  padding: 8px 12px;
  cursor: pointer;
}

#sortOptions .option:hover {
  background: var(--accent-dim);
  color: black;
}


  @media (max-width: 600px) {
    li {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }
    .result-left {
      max-width: none;
    }
    .result-right {
      justify-content: center;
      margin-top: 10px;
    }
    .result-right span.pill {
      font-size: 12px;
      padding: 2px 6px;
    }
    .result-right span.arrow {
      border-top: 4px solid transparent;
      border-bottom: 4px solid transparent;
      border-left: 8px solid var(--accent);
      margin: 0 4px;
    }
    .controls {
      flex-direction: column;
    }
  }
</style>
</head>
<body>
<div class="container">
  <img src="/assets/CoverImage.png" 
       alt="Fallout 76 C.A.M.P. Item Lookup" 
       style="display:block; margin:0 auto; max-width:100%; height:auto;">
  <div class="meta">
    <p class="author">
      Made by <span class="author-name">MrsBlobby</span>
      <a href="https://mrsblobby.github.io/76Tools.html" class="badge-link">Other Tools</a>
    </p>
    <p class="updated">Last Updated: November 1, 2025</p>
  </div>
</div>

    <!-- Version history -->
<div class="container">
    <details>
      <summary>Version History</summary>
      <div class="changelog-entry">
        <h4>v3.0</h4>
        <ul><li>Expansion towards a more generalized database tool:<br>
- Added category icons<br>
- Added plan/entitlement requirements. Icons identify the source to a limited extent, i.e. SCORE, Gold Bullion, Stamps, Atomic Shop. This will be expanded upon in the future<br>
- Added budget costs<br>
- Added search filters<br>
- Added different search options<br>
- General UI cleanup</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v2.3.1</h4>
        <ul><li>Fixed issue that caused crops to not have preview images</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v2.3</h4>
        <ul><li>Results are now displayed in pages of up to 50 entries in an effort to optimize performance</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v2.2.1</h4>
        <ul><li>Hid entries that returned null as a name in database</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v2.2</h4>
        <ul><li>Added sorting options</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v2.1.2</h4>
        <ul><li>Fixed issue that caused a lot of Turret entries to be missing</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v2.1.1</h4>
        <ul><li>Fixed Fauna subcategory not displaying correctly</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v2.1</h4>
        <ul><li>Added embed when linking tool on Discord</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v2.0</h4>
        <ul><li>Reworked UI entirely. Added more mobile-friendly UI</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v1.2</h4>
        <ul><li>Added version history</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v1.1.1</h4>
        <ul><li>Fixed wallpaper images</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v1.1</h4>
        <ul><li>Added image support</li></ul>
      </div>
      <div class="changelog-entry">
        <h4>v1.0</h4>
        <ul><li>Initial creation</li></ul>
      </div>
    </details>
  </div>

<div class="controls">
  <div class="search-line">
    <input type="text" id="searchBox" placeholder="Search..." />
    <div class="custom-dropdown">
      <div id="dropdownSelected">Item Name</div>
      <div id="dropdownOptions">
        <div class="option" data-value="name">Item Name</div>
        <div class="option" data-value="book">Plan Name</div>
        <div class="option" data-value="entm">Entitlement Name</div>
      </div>
    </div>
  </div>

<div class="inline-group">
  <!-- Filters group -->
  <div class="group-filters">
  <div class="custom-dropdown" id="filtersDropdown">
  <div id="filtersButton">
    Filters
    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="filter-icon" style="width:16px; height:16px;">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z" />
    </svg>
  </div>

  <div id="filtersOptions">
    <div class="filter-columns">
      <div class="filter-header">Placement Condition</div>
      <button data-filter="plan">Plan</button>
      <button data-filter="entitlement">Entitlement</button>
    </div>

    <div class="filter-columns">
      <div class="filter-header">Workshop Category</div>
      <button data-filter="c.a.m.p. pieces">C.A.M.P. Pieces</button>
      <button data-filter="decorations">Decorations</button>
      <button data-filter="defense">Defense</button>
      <button data-filter="dwellers">Dwellers</button>
      <button data-filter="furniture">Furniture</button>
      <button data-filter="lights">Lights</button>
      <button data-filter="power">Power</button>
      <button data-filter="quest">Quest</button>
      <button data-filter="resources">Resource</button>
      <button data-filter="storage">Storage</button>
      <button data-filter="structure">Structure</button>
      <button data-filter="utility">Utility</button>
      <button data-filter="wall decor">Wall Decor</button>
      <button data-filter="wallpapers">Wallpapers</button>
    </div>
    
    <!-- Clear All button spanning both columns -->
    <div style="flex-basis: 100%; text-align: center; margin-top: 8px;">
      <button class="clear-filters">Clear All</button>
    </div>
  </div>
</div>
  </div> 

  <!-- Sort group -->
  <div class="group-sort">
    <label for="sortMode">Sort By:</label>
    <div class="custom-dropdown" id="sortDropdown">
      <div id="sortSelected">Workshop Menu ▼</div>
      <div id="sortOptions">
        <div class="option" data-value="camp-top">Workshop Menu ▼</div>
        <div class="option" data-value="camp-bottom">Workshop Menu ▲</div>
        <div class="option" data-value="az">Alphabetical ▼</div>
        <div class="option" data-value="za">Alphabetical ▲</div>
        <div class="option" data-value="old-new">Oldest</div>
        <div class="option" data-value="new-old">Newest</div>
      </div>
    </div>
  </div>
</div>




  <ul id="results"></ul>
  <div id="pagination" style="text-align:center; margin: 16px 0;"></div>

<script>
let db = [];
let currentPage = 1;
const itemsPerPage = 50;
let lastQuery = '';
let currentSort = 'camp-top';
let currentSearchBy = 'name';
let activeFilters = new Set()

// --- Category Icons ---
const CategoryIcons = {
  'Quest': '/assets/MainCategory-QuestsIcon.svg',
  'Objectives': '/assets/MainCategory-QuestsIcon.svg',
  'Wallpapers': '/assets/MainCategory-WallpapersIcon.svg',
  'C.A.M.P. Pieces': '/assets/MainCategory-CAMPPiecesIcon.svg',
  'Foundations': '/assets/SubCategory-FoundationsIcon.png',
  'Decorations': '/assets/MainCategory-DecorationsIcon.svg',
  'Defense': '/assets/MainCategory-DefensesIcon.svg',
  'Dwellers': '/assets/MainCategory-DwellersIcon.svg',
  'Furniture': '/assets/MainCategory-FurnitureIcon.svg',
  'Lights': '/assets/MainCategory-LightsIcon.svg',
  'Power': '/assets/MainCategory-PowerIcon.svg',
  'Resources': '/assets/MainCategory-ResourcesIcon.svg',
  'Storage': '/assets/MainCategory-StorageIcon.svg',
  'Utility': '/assets/MainCategory-UtilityIcon.svg',
  'Wall Decor': '/assets/MainCategory-WallDecorIcon.svg',
  'Structure': '/assets/MainCategory-StructureIcon.svg',
  'Porches': '/assets/SubCategory-PorchesIcon.png',
  'Floors':'/assets/SubCategory-FloorsIcon.png',
  'Walls': '/assets/SubCategory-WallsIcon.png',
  'Roofs': '/assets/SubCategory-RoofsIcon.png',
  'Stairs': '/assets/SubCategory-StairsIcon.png',
  'Shelters': '/assets/SubCategory-SheltersIcon.png',
  'Doors': '/assets/SubCategory-DoorsIcon.png',
  'Columns': '/assets/SubCategory-ColumnsIcon.png',
  'Fences': '/assets/SubCategory-FencesIcon.png',
  'Barricades': '/assets/SubCategory-BarricadeIcon.png',
  'Traps': '/assets/SubCategory-TrapsIcon.png',
  'Turrets': '/assets/SubCategory-TurretsIcon.png',
  'Generators': '/assets/SubCategory-GeneratorsIcon.png',
  'Power Connectors': '/assets/SubCategory-PowerConnectorsIcon.png',
  'Candles': '/assets/SubCategory-CandleIcon.png',
  'Ceiling Lights': '/assets/SubCategory-CeilingLightsIcon.png',
  'Fire': '/assets/SubCategory-FireIcon.png',
  'Lamps': '/assets/SubCategory-LampsIcon.svg',
  'Wall Lights': '/assets/SubCategory-WallLightsIcon.png',
  'Crafting': '/assets/SubCategory-CraftingIcon.png',
  'Collectors': '/assets/SubCategory-CollectorsIcon.png',
  'Food': '/assets/SubCategory-FoodIcon.png',
  'Producers': '/assets/SubCategory-ProducersIcon.png',
  'Water': '/assets/SubCategory-WaterIcon.png',
  'Instruments': '/assets/SubCategory-InstrumentsIcon.png',
  'Player Buffs': '/assets/SubCategory-PlayerBuffsIcon.png',
  'Services': '/assets/SubCategory-ServicesIcon.png',
  'Vending Machines': '/assets/SubCategory-VendingMachinesIcon.png',
  'Appliances': '/assets/SubCategory-AppliancesIcon.png',
  'Beds': '/assets/SubCategory-BedsIcon.png',
  'Electronics': '/assets/SubCategory-ElectronicsIcon.png',
  'Seating': '/assets/SubCategory-SeatingIcon.png',
  'Shelves': '/assets/SubCategory-ShelvesIcon.png',
  'Surfaces': '/assets/SubCategory-SurfacesIcon.png',
  'Balloons': '/assets/SubCategory-BalloonsIcon.png',
  'Clutter': '/assets/SubCategory-ClutterIcon.png',
  'Crockery': '/assets/SubCategory-CrockeryIcon.png',
  'Entertainment': '/assets/SubCategory-EntertainmentIcon.png',
  'Fauna': '/assets/SubCategory-FaunaIcon.png',
  'Lawn & Garden': '/assets/SubCategory-Lawn&GardenIcon.png',
  'Novelties': '/assets/SubCategory-NoveltiesIcon.png',
  'Outdoor': '/assets/SubCategory-OutdoorIcon.png',
  'Rugs': '/assets/SubCategory-RugsIcon.png',
  'Signs': '/assets/SubCategory-SignsIcon.png',
  'Statues': '/assets/SubCategory-StatuesIcon.png',
  'Taxidermy': '/assets/SubCategory-TaxidermyIcon.png',
  'Toys': '/assets/SubCategory-ToysIcon.png',
  'Vehicles': '/assets/SubCategory-VehiclesIcon.png',
  'Accents': '/assets/SubCategory-AccentsIcon.png',
  'Ceiling': '/assets/SubCategory-CeilingIcon.png',
  'Holiday': '/assets/SubCategory-HolidayIcon.png',
  'Mounted': '/assets/SubCategory-MountedIcon.png',
  'Tapestry': '/assets/SubCategory-TapestryIcon.png',
  'Wall Art': '/assets/SubCategory-WallArtIcon.svg',
  'Wall Letters': '/assets/SubCategory-WallLettersIcon.png',
  'Window': '/assets/SubCategory-WindowIcon.png',
  'Additional Storage': '/assets/SubCategory-AdditionalStorageIcon.svg',
  'Displays': '/assets/SubCategory-DisplaysIcon.png',
  'Stash Boxes': '/assets/SubCategory-StashBoxesIcon.png',
  'Farm': '/assets/SubCategory-FarmIcon.png',
  'Frontier': '/assets/SubCategory-FrontierIcon.png',
  'Industrial': '/assets/SubCategory-IndustrialIcon.png',
  'Military': '/assets/SubCategory-MilitaryIcon.png',
  'Modern': '/assets/SubCategory-ModernIcon.png',
  'Retail': '/assets/SubCategory-RetailIcon.png',
  'Rustic': '/assets/SubCategory-RusticIcon.png',
  'Scavenger': '/assets/SubCategory-ScavengerIcon.png',
  'Allies': '/assets/SubCategory-AlliesIcon.svg',
  'Pets': '/assets/SubCategory-PetsIcon.png',
  'Pet Furniture': '/assets/SubCategory-PetFurnitureIcon.png'
};

window.addEventListener('DOMContentLoaded', () => {
  // Clear search bar
  const searchBox = document.getElementById('searchBox');
  searchBox.value = '';
  lastQuery = '';

  // Hide all dropdowns on load
  const filtersOptions = document.getElementById('filtersOptions');
  filtersOptions.style.display = 'none';

  const filtersButton = document.getElementById('filtersButton');
  filtersButton.classList.remove('open');

  const dropdownOptions = document.getElementById('dropdownOptions');
  dropdownOptions.style.display = 'none';
  dropdownSelected.classList.remove('open');

  const sortOptions = document.getElementById('sortOptions');
  sortOptions.style.display = 'none';
  sortSelected.classList.remove('open');

  // Optional: render all results initially
  renderResults('');
});

// --- Manual icon overrides ---
const ManualIcons = {
  'XPD_': '/assets/StampIcon.png',
  '_GoldVendor': '/assets/BullionIcon.png'
};
const ManualEntmIcons = {
  'Babylon_': '/assets/V51Icon.png',
  'F1_': '/assets/SubCategory-AdditionalStorageIcon.svg',
  'Shelters_': '/assets/AtomIcon.png',
};
const miniSeasonAliases = {
  'SCORE_MiniSeason_2025_MMMFE': 'Marshal Mallow'
};

// --- Fetch DB ---
fetch('final_workshop_db.json')
  .then(response => response.json())
  .then(data => {
    db = data;
    renderResults('');
  })
  .catch(err => {
    console.error("Failed to load database:", err);
    document.getElementById('results').innerHTML = '<li>Error loading database.</li>';
  });

// --- Dropdowns ---
const dropdownSelected = document.getElementById('dropdownSelected');
dropdownSelected.textContent = 'Search By: Item Name';
const dropdownOptions = document.getElementById('dropdownOptions');
const sortSelected = document.getElementById('sortSelected');
const sortOptions = document.getElementById('sortOptions');
const filtersButton = document.getElementById('filtersButton');
const filtersOptions = document.getElementById('filtersOptions');
const clearFiltersBtn = document.querySelector('.clear-filters');

function closeAllDropdowns() {
  dropdownOptions.style.display = 'none';
  dropdownSelected.classList.remove('open');
  sortOptions.style.display = 'none';
  sortSelected.classList.remove('open');
  filtersOptions.style.display = 'none';
  filtersButton.classList.remove('open')
}

dropdownSelected.addEventListener('click', e => {
  e.stopPropagation();
  const isOpen = dropdownOptions.style.display === 'block';
  closeAllDropdowns();
  if (!isOpen) {
    dropdownOptions.style.display = 'block';
    dropdownSelected.classList.add('open');
  }
});

sortSelected.addEventListener('click', e => {
  e.stopPropagation();
  const isOpen = sortOptions.style.display === 'block';
  closeAllDropdowns();
  if (!isOpen) {
    sortOptions.style.display = 'block';
    sortSelected.classList.add('open');
  }
});

document.addEventListener('click', closeAllDropdowns);

filtersButton.addEventListener('click', e => {
  e.stopPropagation();
  const isOpen = filtersOptions.style.display === 'block';
  filtersOptions.style.display = isOpen ? 'none' : 'block';
});

filtersOptions.addEventListener('click', e => e.stopPropagation());

clearFiltersBtn.addEventListener('click', () => {
  filtersOptions.querySelectorAll('button.selected').forEach(btn => btn.classList.remove('selected'));
});

filtersOptions.querySelectorAll('button[data-filter]').forEach(btn => {
  btn.addEventListener('click', () => btn.classList.toggle('selected'));
});

// --- Search & Sort Options ---
dropdownOptions.querySelectorAll('.option').forEach(option => {
  option.addEventListener('click', () => {
    currentSearchBy = option.dataset.value;
    dropdownSelected.textContent = 'Search By: ' + option.textContent;
    dropdownOptions.style.display = 'none';
    dropdownSelected.classList.remove('open');
    renderResults(document.getElementById('searchBox').value);
  });
});

sortOptions.querySelectorAll('.option').forEach(option => {
  option.addEventListener('click', () => {
    currentSort = option.dataset.value;
    sortSelected.textContent = option.textContent;
    sortOptions.style.display = 'none';
    sortSelected.classList.remove('open');
    renderResults(document.getElementById('searchBox').value);
  });
});

document.getElementById('searchBox').addEventListener('input', e => renderResults(e.target.value));

// --- Sorting / Pagination ---
function sortItems(items) {
  switch(currentSort) {
    case 'camp-bottom': return [...items].reverse();
    case 'new-old': return [...items].sort((a,b) => (b.CNAM_FormID || '').localeCompare(a.CNAM_FormID || ''));
    case 'old-new': return [...items].sort((a,b) => (a.CNAM_FormID || '').localeCompare(b.CNAM_FormID || ''));
    case 'az': return [...items].sort((a,b) => (a.Name || '').localeCompare(b.Name || ''));
    case 'za': return [...items].sort((a,b) => (b.Name || '').localeCompare(a.Name || ''));
    default: return items;
  }
}

function paginate(items) {
  const start = (currentPage - 1) * itemsPerPage;
  const end = start + itemsPerPage;
  return items.slice(start, end);
}

function renderPagination(totalItems) {
  const pagination = document.getElementById('pagination');
  const totalPages = Math.ceil(totalItems / itemsPerPage);
  pagination.innerHTML = '';
  if (totalPages <= 1) return;

  const prevBtn = document.createElement('button');
  prevBtn.textContent = '← Prev';
  prevBtn.disabled = currentPage === 1;
  prevBtn.onclick = () => { currentPage--; renderResults(document.getElementById('searchBox').value); };
  pagination.appendChild(prevBtn);

  for (let i=1; i<=totalPages; i++) {
    if (i === 1 || i === totalPages || Math.abs(i-currentPage) <= 2) {
      const btn = document.createElement('button');
      btn.textContent = i;
      btn.style.fontWeight = i===currentPage ? 'bold' : 'normal';
      btn.onclick = () => { currentPage = i; renderResults(document.getElementById('searchBox').value); };
      pagination.appendChild(btn);
    } else if (Math.abs(i-currentPage) === 3) {
      const span = document.createElement('span');
      span.textContent = '...';
      pagination.appendChild(span);
    }
  }

  const nextBtn = document.createElement('button');
  nextBtn.textContent = 'Next →';
  nextBtn.disabled = currentPage === totalPages;
  nextBtn.onclick = () => { currentPage++; renderResults(document.getElementById('searchBox').value); };
  pagination.appendChild(nextBtn);
}


filtersOptions.querySelectorAll('button[data-filter]').forEach(btn => {
  btn.addEventListener('click', () => {
    const filter = btn.dataset.filter;
    if (activeFilters.has(filter)) activeFilters.delete(filter);
    else activeFilters.add(filter);

    renderResults(searchBox.value); // visual state updated here
  });
});


clearFiltersBtn.addEventListener('click', () => {
  activeFilters.clear();
  filtersOptions.querySelectorAll('button[data-filter]').forEach(btn => btn.classList.remove('selected'));
  renderResults(searchBox.value);
});

// --- Render results ---
function renderResults(query) {
  const normalizedQuery = query.toLowerCase();
  const queryChanged = normalizedQuery !== lastQuery;
  lastQuery = normalizedQuery;

  // --- filters setup ---
  let placementFilters = new Set(['plan', 'entitlement']);

  function matchesItem(item) {
    if (activeFilters.size === 0) return true; // no filters → always match

    // Separate active filters into types
    const placementActive = [...activeFilters].filter(f => placementFilters.has(f));
    const categoryActive  = [...activeFilters].filter(f => !placementFilters.has(f));

    // --- Placement filters (plan, entitlement) OR logic ---
    const placementMatch = placementActive.length === 0 || placementActive.some(f => 
      (f === 'plan' && item.BOOK_FULL?.trim()) ||
      (f === 'entitlement' && item.ENTM_FULL?.trim())
    );

    // --- Category/subcategory filters OR logic ---
    const categoryMatch = categoryActive.length === 0 || categoryActive.some(f => 
      (item.Category || '').toLowerCase() === f || (item.SubCategory || '').toLowerCase() === f
    );

    // AND across different filter types
    return placementMatch && categoryMatch;
  }

// update filter button visuals
filtersOptions.querySelectorAll('button[data-filter]').forEach(btn => {
  if (activeFilters.has(btn.dataset.filter)) btn.classList.add('selected');
  else btn.classList.remove('selected');
});


  // --- Filter the DB ---
  const filtered = db.filter(item => {
  if (!item.Name || item.Name === 'null' || item.Name.trim() === '') return false;
    // basic search
    let matchesSearch;
    if (!normalizedQuery) matchesSearch = true;
    else if (currentSearchBy === 'name') matchesSearch = item.Name && item.Name.toLowerCase().includes(normalizedQuery);
    else if (currentSearchBy === 'book') matchesSearch = item.BOOK_FULL && item.BOOK_FULL.toLowerCase().includes(normalizedQuery);
    else if (currentSearchBy === 'entm') matchesSearch = item.ENTM_FULL && item.ENTM_FULL.toLowerCase().includes(normalizedQuery);

    const matchesFilters = matchesItem(item); // call the new function

    return matchesSearch && matchesFilters;
  });

  const sorted = sortItems(filtered);

  // reset to page 1 if query changed or current page is out of range
  const totalPages = Math.ceil(sorted.length / itemsPerPage);
  if (queryChanged || currentPage > totalPages) currentPage = 1;

  const paged = paginate(sorted);
  results.innerHTML = '';

  if (!paged.length) {
    results.innerHTML = '<li>No matches found</li>';
    pagination.innerHTML = '';
    return;
  }

  paged.forEach(r => {
    if ((r.SubCategory || '').trim().toLowerCase() === 'testsubcat'.toLowerCase()) return;

    const li = document.createElement('li');

    const left = document.createElement('div');
    left.className = 'result-left';

    const name = document.createElement('div');
    name.className = 'result-name';
    name.textContent = r.Name;
    left.appendChild(name);

    if (r.CNAM_FormID) {
      const img = document.createElement('img');
      img.src = `Images/${r.CNAM_FormID.toLowerCase()}.png`;
      img.alt = r.Name;
      img.loading = "lazy";
      left.appendChild(img);
    }

    const right = document.createElement('div');
    right.className = 'result-right';

    // --- Build Menu Category header + pills ---
    if ((r.Category && r.Category.trim() !== '') || (r.SubCategory && r.SubCategory.trim() !== '')) {
      const catHeader = document.createElement('div');
      catHeader.className = 'section-header';
      catHeader.textContent = 'Build Menu Category';
      right.appendChild(catHeader);

      const catWrap = document.createElement('div');
      catWrap.className = 'inline-wrap';

      const categories = [];
      if (r.Category && r.Category.trim() !== '') categories.push(r.Category);
      if (r.SubCategory && r.SubCategory.trim() !== '' && (r.Category || '').toLowerCase() !== 'wallpapers') categories.push(r.SubCategory);

      categories.forEach((cat, i) => {
        const catSpan = document.createElement('span');
        catSpan.className = 'pill';
        catSpan.textContent = '';

        const iconPath = CategoryIcons[cat];
        if (iconPath) {
          const icon = document.createElement('img');
          icon.src = iconPath;
          const isSVG = iconPath.toLowerCase().endsWith('.svg');
          icon.style.height = isSVG ? '24px' : '30px';
          icon.style.width = 'auto';
          icon.style.verticalAlign = 'middle';
          icon.style.marginRight = '6px';
          catSpan.appendChild(icon);
        }

        catSpan.appendChild(document.createTextNode(cat));
        catWrap.appendChild(catSpan);

        if (i < categories.length - 1) {
          const arrow = document.createElement('span');
          arrow.className = 'arrow';
          catWrap.appendChild(arrow);
        }
      });

      right.appendChild(catWrap);
    }

    // --- Placement Conditions header + pills ---
    const hasBook = !!(r.BOOK_FULL && String(r.BOOK_FULL).trim());
    const hasEntm = !!(r.ENTM_FULL && String(r.ENTM_FULL).trim());
    if (hasBook || hasEntm) {
      const condHeader = document.createElement('div');
      condHeader.className = 'section-header';
      condHeader.textContent = 'Placement Conditions';
      condHeader.style.marginTop = '8px';
      right.appendChild(condHeader);

      const condWrap = document.createElement('div');
      condWrap.className = 'inline-wrap';

      const isDirect = (String(r.BOOK_SOURCE || '').toLowerCase() === 'direct');
      const connectorWord = isDirect ? 'and' : 'or';

      // --- BOOK pill ---
      if (hasBook) {
        const bookPill = document.createElement('span');
        bookPill.className = 'pill';
        bookPill.textContent = r.BOOK_FULL;

        const bookEdid = String(r.BOOK_EditorID || '');
        let iconSrc = '';
        const ManualIcons = {
          'XPD_': '/assets/StampIcon.png',
          '_GoldVendor': '/assets/BullionIcon.png',
        };
        for (const key in ManualIcons) {
          if (bookEdid.includes(key)) {
            iconSrc = ManualIcons[key];
            break;
          }
        }

        if (iconSrc) {
          const icon = document.createElement('img');
          icon.src = iconSrc;
          icon.style.width = '30px';
          icon.style.height = '30px';
          icon.style.verticalAlign = 'middle';
          icon.style.marginRight = '6px';
          bookPill.innerHTML = '';
          bookPill.appendChild(icon);
          bookPill.appendChild(document.createTextNode(r.BOOK_FULL));
        }

        condWrap.appendChild(bookPill);
      }

      // --- connector ---
      if (hasBook && hasEntm) {
        const conn = document.createElement('span');
        conn.className = 'connector';
        conn.textContent = connectorWord;
        condWrap.appendChild(conn);
      }
      // --- ENTM pill ---
    if (hasEntm) {
  const entmFullList = r.ENTM_FULL
    ?.split(';')
    .map(s => s.trim())
    .filter(Boolean) || [];

  const entmEdidList = (r.ENTM_EDID || '')
    .split(';')
    .map(s => s.trim())
    .filter(Boolean);

  const ManualEntmIcons = {
    'Babylon_': '/assets/V51Icon.png',
    'Shelters_': '/assets/AtomIcon.png',
    'F1_': '/assets/SubCategory-AdditionalStorageIcon.svg'
  };

  entmFullList.forEach((fullName, index) => {
    const edid = entmEdidList[index] || '';

    // Determine default tag
    let tag = '';
    const edidUpper = edid.toUpperCase();
    if (edidUpper.includes('ATX')) tag = 'Atomic Shop';
    else if (edidUpper.includes('SCORE_MINISEASON')) tag = 'Mini Season';
    else if (/SCORE[_-]?S?(\d+)/i.test(edid)) tag = 'S.C.O.R.E. - Season';
    else if (edidUpper.includes('SCORE')) tag = 'S.C.O.R.E.';

    // Create pill
    const pill = document.createElement('span');
    pill.className = 'pill';

    const icon = document.createElement('img');
    icon.style.width = '30px';
    icon.style.height = '30px';
    icon.style.verticalAlign = 'middle';
    icon.style.marginRight = '6px';

    // Apply manual icons
    for (const key in ManualEntmIcons) {
      if (edid.includes(key)) {
        icon.src = ManualEntmIcons[key];
        break;
      }
    }

    // Fallback icon if none applied
    if (!icon.src) icon.src = '/assets/SeasonIcon.png';

    pill.appendChild(icon);
    pill.appendChild(document.createTextNode(fullName));

    condWrap.appendChild(pill);
  });
}


      right.appendChild(condWrap);
    }

    // --- attach left + right divs to li ---
    li.appendChild(left);
    li.appendChild(right);
    results.appendChild(li);
  });

  renderPagination(sorted.length);
}
</script>
</body>
</html>